<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Islamic Prayer Alarm</title>

<style>
body{
margin:0;
font-family:Arial, sans-serif;
background:url('https://images.unsplash.com/photo-1542810634-71277d95dcbb?auto=format&fit=crop&w=1600&q=80') no-repeat center center fixed;
background-size:cover;
color:white;
text-align:center;
}

.overlay{
background:rgba(0,0,0,0.75);
min-height:100vh;
padding:20px;
}

h1{margin-bottom:5px;}

#clock{
font-size:22px;
margin-bottom:10px;
color:#FFD700;
}

#city{
font-size:20px;
margin-bottom:15px;
color:#FFD700;
}

.box{
background:rgba(0,0,0,0.6);
padding:15px;
border-radius:10px;
max-width:700px;
margin:auto;
margin-bottom:20px;
}

.row{
display:flex;
justify-content:space-between;
align-items:center;
padding:8px;
border-bottom:1px solid rgba(255,255,255,0.2);
}

input[type="checkbox"]{
transform:scale(1.3);
cursor:pointer;
}

input[type="time"]{
padding:6px;
border-radius:5px;
border:none;
}

button{
padding:8px 15px;
border:none;
border-radius:6px;
cursor:pointer;
background:#4CAF50;
color:white;
}

.footer{
margin-top:40px;
font-size:20px;
color:#FFD700;
font-weight:bold;
}
</style>
</head>

<body>
<div class="overlay">

<h1>Prayer & Roza Alarm System</h1>
<div id="clock"></div>
<div id="city">Detecting Location...</div>

<div class="box" id="timingBox"></div>

<div class="box">
<h3>Set Your Custom Alarm</h3>
<input type="time" id="customTime">
<button onclick="setCustomAlarm()">Save Alarm</button>
</div>

<div class="footer">Created by Muhammad Jameer</div>

<audio id="alarmAudio" preload="auto">
<source src="naat.mp3" type="audio/mpeg">
</audio>

</div>

<script>

const clock=document.getElementById("clock");
const cityDiv=document.getElementById("city");
const timingBox=document.getElementById("timingBox");
const alarmAudio=document.getElementById("alarmAudio");

function updateClock(){
clock.innerText=new Date().toLocaleTimeString();
}
setInterval(updateClock,1000);
updateClock();

let timings={};
let alarms={};

navigator.geolocation.getCurrentPosition(success,error);

function success(position){
const lat=position.coords.latitude;
const lon=position.coords.longitude;

fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${lat}&longitude=${lon}&localityLanguage=en`)
.then(res=>res.json())
.then(data=>{
cityDiv.innerText="City: "+(data.city||data.locality||"Unknown");
});

fetch(`https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lon}&method=2`)
.then(res=>res.json())
.then(data=>{
timings=data.data.timings;
renderTimings();
});
}

function error(){
cityDiv.innerText="Location permission denied.";
}

function renderTimings(){

function convert12(time){
let [h,m]=time.split(":");
h=parseInt(h);
let ampm=h>=12?"PM":"AM";
h=h%12||12;
return h+":"+m+" "+ampm;
}

let [fh,fm]=timings.Fajr.split(":").map(Number);
fm=fm-1;
if(fm<0){fm=59;fh--;}
let sehri=formatTime(fh,fm);

let iftar=convert12(timings.Maghrib);

const list=[
["Sehri",sehri],
["Fajr",convert12(timings.Fajr)],
["Dhuhr",convert12(timings.Dhuhr)],
["Asr",convert12(timings.Asr)],
["Iftar",iftar],
["Isha",convert12(timings.Isha)]
];

timingBox.innerHTML="";

list.forEach(item=>{
const row=document.createElement("div");
row.className="row";
row.innerHTML=`
<span>${item[0]} - ${item[1]}</span>
<input type="checkbox" onchange="toggleAlarm('${item[1]}','${item[0]}',this)">
`;
timingBox.appendChild(row);
});

}

function formatTime(h,m){
let ampm=h>=12?"PM":"AM";
h=h%12||12;
return h+":"+(m<10?"0"+m:m)+" "+ampm;
}

function toggleAlarm(timeStr,label,box){
if(box.checked){
setAlarm(timeStr,label);
}else{
if(alarms[label]) clearTimeout(alarms[label]);
}
}

function setAlarm(timeStr,label){

let [h,mPart]=timeStr.split(":");
let m=parseInt(mPart);
let isPM=mPart.includes("PM");
h=parseInt(h);

if(isPM && h!=12) h+=12;
if(!isPM && h==12) h=0;

let now=new Date();
let alarmTime=new Date();
alarmTime.setHours(h,m,0,0);

let diff=alarmTime-now;
if(diff<0) diff+=86400000;

alarms[label]=setTimeout(()=>{
alarmAudio.play();
alert(label+" Time");
},diff);
}

function setCustomAlarm(){
let value=document.getElementById("customTime").value;
if(!value) return alert("Select time");

let [h,m]=value.split(":").map(Number);
let now=new Date();
let alarmTime=new Date();
alarmTime.setHours(h,m,0,0);

let diff=alarmTime-now;
if(diff<0) diff+=86400000;

setTimeout(()=>{
alarmAudio.play();
alert("Custom Alarm");
},diff);

alert("Custom Alarm Saved");
}

</script>
</body>
</html>